%h4.subtitle{ id: "#{grade_type}TableCaption" }
  = subtitle
  %span.label.alert= count

- grades_by_assignment.each do |assignment, grades|
  %div{ class: "assignment-#{grade_type}"}
    %h4.assignment_name
      = link_to assignment.name, assignment
      - if assignment.is_individual?
        = link_to glyph(:check) + "Quick Grade", mass_grade_assignment_path(assignment), class: "button"
      - else
        = link_to glyph(:check) + "Grade", assignment, class: "button"

    = form_tag edit_status_grades_assignment_path(assignment), method: :get do

      %table.nofeatures_default_last_name_dynatable
        %thead
          %tr
            - if assignment.is_individual?
              %th{scope: "col", :width => "8%"} First Name
              %th{scope: "col", :width => "8%"} Last Name
              - if course.has_teams?
                %th{scope: "col", :width => "15%"}= "#{term_for :team}"
            - elsif assignment.has_groups?
              %th{scope: "col"} Group
            %th{scope: "col", :width => "8%", "data-dynatable-sorts" => "numericScore"} Score
            %th{scope: "col"} Feedback
            %th{scope: "col", "data-dynatable-no-sort" => "true", :width => "20%" }
              %span.sr-only Actions
            %th{"data-dynatable-no-sort" => "true", :width => "120px" }
              %button.button.select-all= "Check"
              %button.button.select-none= "Uncheck"
          %tbody
            - grades.each do |grade|
              - student = grade.student
              - team = student.team_for_course(course) if student
              - group = grade.group
              %tr
                - if assignment.is_individual?
                  %td= link_to student.first_name, student_path(student)
                  %td= link_to student.last_name, student_path(student)
                  %td
                    - if course.has_teams? && student.present? && team.present?
                      = link_to team.name, team
                - elsif assignment.has_groups?
                  %td= link_to group.try(:name), group_path(group)
                %td= points grade.score
                %td= raw grade.feedback
                %td
                  .right
                    %ul.button-bar
                      - if assignment.is_individual?
                        %li= link_to glyph(:eye) + "See Grade", assignment_grade_path(assignment, student_id: student.id), class: "button"
                        %li= link_to glyph(:edit) + "Edit Grade", edit_assignment_grade_path(assignment_id: assignment.id, student_id: student.id), class: "button"
                      - elsif assignment.has_groups?
                        %li= link_to glyph(:eye) + "See Grade", assignment_grade_path(assignment, group_id: group.id), class: 'button'
                        %li= link_to glyph(:check) + "Edit Grade", group_grade_assignment_path(assignment, group_id: group.id), class: "button"
                %td.center= check_box_tag "grade_ids[]", grade.id, false, data: { behavior: "toggle-disable-list-command", commands: "[data-behavior='selected-#{grade_type}-grades-command']" }

      .submit-buttons
        .right
          = submit_tag "Update Selected Grade Statuses", class: "button disabled", disabled: true, data: { behavior: "selected-unreleased-grades-command" }

  %hr.dotted
