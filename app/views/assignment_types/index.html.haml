= content_nav_for AssignmentType

%h2.pagetitle#tableCaption= @title

= render partial: "analytics/buttons"

.pageContent
  = render partial: "layouts/alerts"

  = render partial: "analytics/in_page_nav"

  %table.dynatable{"aria-describedby" => "tableCaption"}
    %thead
      %tr
        %th{scope: "col"} Name
        %th{scope: "col", "data-dynatable-sorts": "numericScore"} Max Points
        %th{scope: "col"}
          %span.sr-only Actions
    %tbody
      - @assignment_types.each do |assignment_type|
        %tr
          %td= assignment_type.name
          %td= points assignment_type.total_points
          %td
            %ul.button-bar.right

              %li
                %a{:href => edit_assignment_type_path(assignment_type), class: "button"}
                  %i.fa.fa-edit.fa-fw
                  Edit
                  %span.sr-only= assignment_type.name
              %li
                %a{:href => export_scores_assignment_type_path(assignment_type.id, course_id: current_course.id, format: "csv"), class: "button"}
                  %i.fa.fa-cloud-download.fa-fw
                  Download Scores


  %h3.subtitle= "#{term_for :student} Scores"

  .scroll-table
    %table.dynatable.no-table-header.no-button-bar
      %thead
        %tr
          %th First Name
          %th Last Name
          - @assignment_types.each do |at|
            %th= "#{at.name} Points"
            - if at.student_weightable?
              %th= "#{at.name} Weighted Points"
      %tbody
        - @students.each do |student|
          %tr
            %td= link_to student.first_name, student_path(student)
            %td= link_to student.last_name, student_path(student)
            - @assignment_types.each do |at|
              %td= points at.visible_score_for_student(student)
              - if at.student_weightable?
                %td= points at.raw_points_for_student(student)
                %span.sr-only= at.name

  %h3.subtitle= "#{term_for :student} Grade Counts"

  .scroll-table
    %table.dynatable.no-table-header.no-button-bar
      %thead
        %tr
          %th First Name
          %th Last Name
          - @assignment_types.each do |at|
            %th= "#{at.name} Grade Count"
            %th= "#{at.name} Grades > 0 Count"

      %tbody
        - @students.each do |student|
          %tr
            %td= link_to student.first_name, student_path(student)
            %td= link_to student.last_name, student_path(student)
            - @assignment_types.each do |at|
              %td= points at.grades.where(student_id: student.id).graded_or_released.count
              %td= points "#{at.grades.where(student_id: student.id).graded_or_released.positive.count }"
